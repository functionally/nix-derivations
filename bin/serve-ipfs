#!/usr/bin/env nix-shell
#!nix-shell -I nixpkgs=https://github.com/NixOS/nixpkgs/archive/bc260badaebf67442befe20fb443034d3a91f2b3.tar.gz -p ipfs -i bash


if [ -d /data/ipfs/repo ]
then
    export IPFS_PATH=/data/ipfs/repo
elif [ -d /data/ipfs ]
then
    export IPFS_PATH=/data/ipfs
elif [ -d "$HOME"/ipfs ]
then
    export IPFS_PATH="$HOME"/ipfs
else
    export IPFS_PATH="$HOME"/.ipfs
fi

while true
do
# IPFS_LOGGING=warning ipfs daemon --enable-gc --enable-namesys-pubsub
  IPFS_LOGGING=error   ipfs daemon --enable-gc --enable-namesys-pubsub --enable-pubsub-experiment
  echo "Restarting IPFS server in 90 seconds . . ."
  sleep 90s
done
